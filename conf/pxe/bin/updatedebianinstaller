#!/usr/bin/env bash

description="Download latest Debian stable netboot in order to update PXE installer support"
author="Choops <choopsbd@gmail.com>"

c0="\e[0m"
ce="\e[31m"
cok="\e[32m"
ci="\e[36m"

error="${ce}E${c0}:"
done="${cok}OK${c0}:"

set -e

usage() {
    echo -e "${ci}${description}\nUsage${c0}:"
    echo -e "  $(basename "$0") [OPTION]"
    echo -e "${ci}Options${c0}:"
    echo -e "  -h,--help: Print this help\n"
}

updateinstaller() {
    tmpfolder = /tmp

    if [[ ! -d "$2" ]]; then
        echo -e "${error} '$2' does not exist. '$(hostname -f)' may not be a PXE server"
        exit 1
    fi

    pushd "${tmpfolder}" &>/dev/null
    wget "$3"
    tar -zxvf netboot.tar.gz
    rm -rf "$2/$1"-installer
    mv "$1"-installer "$2"/
    popd &>/dev/null

    echo -e "${done} '$1' netboot updated"
}

[[ $# -gt 1 ]] echo -e "${error} Too many arguments." && usage && exit 1
[[ $1 =~ ^-(h|-help)$ ]] && usage && exit 0
[[ $(whoami) != root ]] && echo -e "${error} Need higher privileges"

distro = debian
dstfolder = /home/tftp/debianstable
url = "http://ftp.nl.debian.org/debian/dists/stable/main/installer-amd64/current/images/netboot/netboot.tar.gz"

updateinstaller "${distro}" "${dstfolder}" "${url}"
